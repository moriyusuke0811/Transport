function addTempTrackNode(latlng, opts={}){
  const icon=L.divIcon({ html:`<div class="tempSquare"></div>`, iconSize:[12,12], iconAnchor:[6,6] });
  const marker=L.marker(latlng,{icon,draggable:true}).addTo(tempTrackLayer);

  // 追加: ドラッグ時に駅にスナップ
  const node={latlng,marker,snapStationId:opts.snapStationId||null};
  marker.on('drag', ev=>{
    let pos=ev.target.getLatLng();
    const snapId=findNearestBuiltStationId(pos,20);
    if(snapId){
      pos=DB.stations[snapId].latlng;
      node.snapStationId=snapId;
    } else {
      node.snapStationId=null;
    }
    node.latlng=pos;
    ev.target.setLatLng(pos); // マーカー位置を更新
    updateTempPreview();
    updateTempTrackCost();
  });

  temp.trackNodes.push(node);
  updateTempPreview(); updateTempTrackCost();
}
