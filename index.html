<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>鉄道シミュレーション管理システム</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: #f2f2f2;
    }

    #map {
      width: 100%;
      height: 100vh;
      z-index: 1;
    }

    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      display: flex;
      gap: 8px;
    }

    .tab {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background-color 0.2s;
    }

    .tab:hover {
      background-color: #e8f0fe;
    }

    .tab.active {
      background-color: #d2e3fc;
    }

    .panel {
      position: absolute;
      top: 50px;
      left: 10px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      width: 240px;
      display: none;
      z-index: 1001;
    }

    .panel.active {
      display: block;
    }

    button {
      margin-top: 4px;
      width: 100%;
      padding: 6px;
      border: none;
      border-radius: 4px;
      background-color: #4285f4;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    button:hover {
      background-color: #3367d6;
    }

    h3 {
      margin-top: 0;
      font-size: 16px;
      text-align: center;
      color: #333;
    }

  </style>
</head>
<body>

  <div id="ui">
    <div class="tab active" data-target="buildPanel">🏗️ 建設</div>
    <div class="tab" data-target="routePanel">🚉 路線</div>
    <div class="tab" data-target="vehiclePanel">🚄 車両</div>
    <div class="tab" data-target="statsPanel">📊 統計</div>
  </div>

  <!-- 建設メニュー -->
  <div class="panel active" id="buildPanel">
    <h3>建設メニュー</h3>
    <button id="stationMode">駅設置（予算必要）</button>
    <button id="trackMode">線路敷設（予算必要）</button>
    <button id="cancelBuild">キャンセル</button>
  </div>

  <!-- 路線メニュー -->
  <div class="panel" id="routePanel">
    <h3>路線メニュー</h3>
    <button id="createRoute">新しい路線を作成</button>
    <button id="editRoute">既存路線を編集</button>
    <button id="deleteRoute">路線削除</button>
  </div>

  <!-- 車両メニュー -->
  <div class="panel" id="vehiclePanel">
    <h3>車両メニュー</h3>
    <button id="buyTrain">車両購入</button>
    <button id="assignTrain">路線に割り当て</button>
    <button id="manageTrain">車両管理</button>
  </div>

  <!-- 統計メニュー -->
  <div class="panel" id="statsPanel">
    <h3>統計メニュー</h3>
    <button id="viewUsage">利用データ</button>
    <button id="viewFinance">資金グラフ</button>
    <button id="viewNetwork">路線ネットワーク</button>
  </div>

  <div id="map"></div>

  <script>
    // === Leaflet地図初期化 ===
    const map = L.map('map').setView([35.681236, 139.767125], 12);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      maxZoom: 19
    }).addTo(map);

    // === タブ切り替え ===
    const tabs = document.querySelectorAll('.tab');
    const panels = document.querySelectorAll('.panel');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        panels.forEach(p => p.classList.remove('active'));
        document.getElementById(tab.dataset.target).classList.add('active');
      });
    });

    // === モード変数 ===
    let mode = null;
    const stations = [];
    const tracks = [];
    const routes = [];

    // === 駅設置 ===
    document.getElementById('stationMode').addEventListener('click', () => {
      mode = 'station';
      alert('駅設置モードです。地図上をクリックして駅を追加してください。');
    });

    // === 線路敷設 ===
    document.getElementById('trackMode').addEventListener('click', () => {
      mode = 'track';
      alert('線路敷設モードです。駅同士を結んでください。');
    });

    // === キャンセル ===
    document.getElementById('cancelBuild').addEventListener('click', () => {
      mode = null;
      alert('建設モードを解除しました。');
    });

    // === 路線作成 ===
    document.getElementById('createRoute').addEventListener('click', () => {
      mode = 'route';
      alert('路線作成モードです。駅を選択して環状路線を作成します。');
    });

    // === 地図クリック動作 ===
    let tempTrack = [];
    map.on('click', function(e) {
      if (mode === 'station') {
        const marker = L.marker(e.latlng).addTo(map);
        stations.push(e.latlng);
        marker.bindTooltip(`駅${stations.length}`, {permanent: true, direction: 'right'});
      } else if (mode === 'track') {
        tempTrack.push(e.latlng);
        if (tempTrack.length === 2) {
          const line = L.polyline(tempTrack, {color: '#555', weight: 4}).addTo(map);
          tracks.push(line);
          tempTrack = [];
        }
      } else if (mode === 'route') {
        tempTrack.push(e.latlng);
        if (tempTrack.length >= 3) {
          const line = L.polyline([...tempTrack, tempTrack[0]], {color: '#1a73e8', weight: 3, dashArray: '5,5'}).addTo(map);
          routes.push(line);
          alert('環状路線を作成しました。');
          tempTrack = [];
        }
      }
    });
  </script>

</body>
</html>
